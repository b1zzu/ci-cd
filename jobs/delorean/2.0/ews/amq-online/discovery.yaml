---
- job:
    name: delorean-2-ews/amq-online/discovery
    display-name: AMQ Online Discovery
    description: |
      <h2>Click <a href="https://github.com/integr8ly/ci-cd/tree/master/jobs/delorean/2.0/ews/amq-online">here</a> to see the job definition on GitHub!</h2>

      <h3>This job gets triggered by <a href="https://brewweb.engineering.redhat.com/brew/packageinfo?packageID=74050">Brew Builds</a> on the UMB</h3>
    disabled: false
    project-type: pipeline

    # Trigger responds to new builds of amq7-amq-online-1-controller-manager-operator-metadata-container
    # e.g. https://brewweb.engineering.redhat.com/brew/packageinfo?packageID=74050
    triggers:
      - ci-trigger:
          override-topic: Consumer.rh-jenkins-ci-plugin.8cfe81de-2e51-4b77-96a9-191a1a559fb1.VirtualTopic.eng.brew.build.complete
          message-checks:
            - field: '$.info.package_id'
              value: '74050'

    parameters:
    - string:
        name: CI_MESSAGE
        description: This will be populated by the CI trigger
    - string:
        name: productName
        description: The name of the product
        default: 'amq-online'
    - string:
        name: sourceBranch
        description: The branch to base the product-next branch off
        default: 'delorean-ews'
    - string:
        name: mailTo
        description: An email address which recieves a mail generated by the pipeline
        default: 'cloud-services-delorean-ews@redhat.com'
    - bool:
        name: 'isGA'
        default: false
        description: '[OPTIONAL] Determines if this is a GA release or not (Temporary option, will be removed)!'
    - bool:
        name: 'dryRun'
        default: false
        description: '[OPTIONAL] Dry run, disables steps which impact external systems!'
    - bool:
        name: 'createJIRA'
        default: false
        description: '[OPTIONAL] Controls the creation of a JIRA. It is disabled by default for now!'
    - bool:
        name: 'createPR'
        default: false
        description: '[OPTIONAL] Controls the creation of a Pull Request. It is disabled by default for now!'

    pipeline-scm:
      script-path: jobs/delorean/jenkinsfiles/2.0/ews/discovery/umb/Jenkinsfile
      scm:
        - git:
            branches:
              - master
            url: 'https://github.com/integr8ly/ci-cd.git'
            skip-tag: true
            wipe-workspace: false
